<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title data-fr="MonRdvFacile - Vos Événements Simplement" data-en="MyEasyMeeting - Your Events Made Simple">MonRdvFacile - Vos Événements Simplement</title>
    <meta name="description" content="Créez, gérez et trouvez des événements facilement avec MonRdvFacile. Organisation simplifiée pour tous vos rassemblements à Royan et Charente-Maritime (17).">
    <meta name="keywords" content="événements, royan, 17000, charente-maritime, gestion d'événements, inscription en ligne, organisation facile, mon rdv facile, evenementiel royan, créer événement, trouver événement">
    <meta name="author" content="MonRdvFacile">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="https://www.monrdvfacile.lpp.ovh/">

    <meta property="og:type" content="website">
    <meta property="og:url" content="https://www.monrdvfacile.lpp.ovh/">
    <meta property="og:title" content="MonRdvFacile - Événements à Royan et Alentours">
    <meta property="og:description" content="Créez, gérez et participez à des événements facilement. Idéal pour associations et rassemblements à Royan (17000).">
    <meta property="og:locale" content="fr_FR">
    <meta property="og:site_name" content="MonRdvFacile">


    <meta name="twitter:card" content="summary_large_image"> <meta name="twitter:url" content="https://www.monrdvfacile.lpp.ovh/">
    <meta name="twitter:title" content="MonRdvFacile - Simplifiez vos Événements">
    <meta name="twitter:description" content="Organisation d'événements simplifiée à Royan et Charente-Maritime (17).">
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-K2JVSXZXNN"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-K2JVSXZXNN');
    </script>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A==" crossorigin="anonymous" referrerpolicy="no-referrer" />

    <style>
        /* --- Inline CSS for index.html - "WOW" Factor Update --- */

        /* --- 1. Global Resets & Base --- */
        :root {
            --primary-color: #007bff; /* Vibrant Blue */
            --primary-darker: #0056b3;
            --secondary-color: #17a2b8; /* Teal */
            --accent-color: #ffc107; /* Bright Yellow/Gold */
            --accent-alt-color: #fd7e14; /* Warm Orange */
            --text-color: #343a40; /* Dark Grey */
            --text-light-color: #6c757d; /* Medium Grey */
            --bg-color: #f8f9fa; /* Very Light Grey */
            --white-color: #ffffff;
            --success-color: #28a745;
            --danger-color: #dc3545;
            --card-shadow: 0 8px 25px rgba(0, 0, 0, 0.08);
            --card-hover-shadow: 0 12px 35px rgba(0, 0, 0, 0.12);
            --border-radius-md: 8px;
            --border-radius-lg: 12px;
        }

        *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
        html { font-size: 16px; scroll-behavior: smooth; -webkit-text-size-adjust: 100%; }
        body {
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            line-height: 1.7; background-color: var(--bg-color);
            color: var(--text-color); display: flex; flex-direction: column; min-height: 100vh;
            -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale;
        }

        /* --- 2. Typography --- */
        h1, h2, h3, h4, h5, h6 { font-weight: 700; color: #2c3e50; margin-bottom: 1rem; line-height: 1.3; }
        h1 { font-size: 2.8rem; }
        h2 { font-size: 2rem; color: var(--primary-color); }
        h3 { font-size: 1.5rem; }
        p { margin-bottom: 1.2rem; color: var(--text-light-color); }
        a { color: var(--primary-color); text-decoration: none; transition: color 0.2s ease, opacity 0.2s ease; }
        a:hover, a:focus { color: var(--primary-darker); opacity: 0.85; }

        /* --- 3. Layout & Container --- */
        .container { width: 90%; max-width: 1320px; margin-left: auto; margin-right: auto; padding: 30px 20px; }
        main.container { flex-grow: 1; padding-top: 40px; padding-bottom: 40px; }

        /* --- 4. Language Toggle --- */
        .lang-toggle { text-align: right; margin-bottom: 1rem; font-size: 0.9rem; position: absolute; top: 20px; right: 25px; z-index: 1001;}
        .lang-link { color: var(--text-light-color); text-decoration: none; padding: 0.4rem 0.6rem; border-radius: var(--border-radius-md); font-weight: 500; }
        .lang-link.active { font-weight: 700; color: var(--primary-color); background-color: rgba(0, 123, 255, 0.1); }
        .lang-link:hover { background-color: rgba(0, 123, 255, 0.07); text-decoration: none; }

        /* --- 5. Header & Footer Placeholders --- */
        #app-header { background-color: var(--white-color); color: var(--text-color); box-shadow: 0 3px 10px rgba(0,0,0,0.05); position: sticky; top: 0; z-index: 1000; }
        .header-container { display: flex; justify-content: space-between; align-items: center; padding-top: 1rem; padding-bottom: 1rem; max-width: 1320px; margin: 0 auto; width: 90%;}
        .logo a { font-size: 1.75rem; font-weight: 700; color: var(--primary-color); text-decoration: none; }
        .main-nav ul { list-style: none; margin: 0; padding: 0; display: flex; align-items: center; }
        .main-nav li { margin-left: 25px; }
        .main-nav a { color: var(--text-color); text-decoration: none; font-size: 1rem; font-weight:500; padding: 8px 12px; border-radius: var(--border-radius-md); transition: background-color 0.2s ease, color 0.2s ease; }
        .main-nav a:hover, .main-nav a.active { background-color: var(--primary-color); color: var(--white-color); }
        .main-nav .nav-text { margin-left: 5px; } /* For icons in nav links */
        .mobile-nav-toggle { display: none; border: none; background: none; color: var(--text-color); font-size: 1.6rem; cursor: pointer; }

        #app-footer { background-color: #2c3e50; color: #bdc3c7; padding: 3rem 0; text-align: center; font-size: 0.9rem; }
        #app-footer a { color: #ecf0f1; }
        #app-footer a:hover { color: var(--primary-color); }
        .footer-container { max-width: 1320px; margin: 0 auto; width: 90%; }

        /* --- 6. Hero Section & CTAs --- */
        .hero-section {
            text-align: center; padding: 80px 30px;
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            color: var(--white-color);
            border-radius: var(--border-radius-lg); margin-bottom: 50px;
            box-shadow: 0 10px 40px rgba(0, 123, 255, 0.3);
        }
        .hero-section h1 {
            font-size: 3.5rem; font-weight: 700; margin-bottom: 1.5rem;
            color: var(--white-color);
            text-shadow: 1px 1px 3px rgba(0,0,0,0.1);
        }
        .hero-section .subtitle { font-size: 1.35rem; color: rgba(255,255,255,0.9); margin-bottom: 3rem; max-width: 750px; margin-left: auto; margin-right: auto; line-height: 1.8; }
        .cta-buttons { display: flex; justify-content: center; align-items: center; gap: 25px; flex-wrap: wrap; }
        .btn {
            display: inline-flex; align-items:center; justify-content:center; gap: 8px;
            font-weight: 600; text-align: center; vertical-align: middle;
            cursor: pointer; user-select: none; border: 2px solid transparent;
            padding: 0.9rem 2.2rem; font-size: 1.1rem; line-height: 1.5; border-radius: 50px; /* Pill shape */
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1); letter-spacing: 0.5px;
            text-transform: uppercase;
        }
        .btn-primary-cta {
            background-color: var(--white-color); color: var(--primary-color);
            box-shadow: 0 5px 20px rgba(255, 255, 255, 0.3);
        }
        .btn-primary-cta:hover { background-color: var(--white-color); color: var(--primary-darker); transform: translateY(-4px); box-shadow: 0 8px 25px rgba(255, 255, 255, 0.4); }
        
        .btn-secondary-cta { /* For "Find an Event" or alternative */
             background-color: transparent; color: var(--white-color); border-color: var(--white-color);
        }
        .btn-secondary-cta:hover { background-color: var(--white-color); color: var(--primary-color); transform: translateY(-4px); }

        .modify-event-link { display: block; margin-top: 25px; color: rgba(255,255,255,0.8); font-size: 0.95rem; }
        .modify-event-link:hover { color: var(--white-color); text-decoration: underline;}
        .modify-event-link i { margin-right: 5px; }

        /* --- 7. Search and Filter Bar --- */
        .filter-section {
            background-color: var(--white-color); padding: 30px; border-radius: var(--border-radius-lg);
            margin-bottom: 40px; box-shadow: var(--card-shadow);
            display: flex; flex-wrap: wrap; gap: 20px; align-items: flex-end;
        }
        .filter-section .form-group { flex: 1 1 220px; margin-bottom: 0; }
        .filter-section label { display: block; font-weight: 600; color: var(--text-color); margin-bottom: 0.5rem; font-size: 0.95rem; }
        .filter-section input[type="text"], .filter-section input[type="date"], .filter-section select {
            width: 100%; padding: 0.75rem 1rem; font-size: 1rem;
            border: 1px solid #dce4ec; border-radius: var(--border-radius-md);
            background-color: #fdfdfd; color: var(--text-color);
            transition: border-color 0.2s, box-shadow 0.2s;
        }
        .filter-section input[type="text"]:focus, .filter-section input[type="date"]:focus, .filter-section select:focus {
            border-color: var(--primary-color); box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.15); outline: none;
        }
        .filter-section .btn { /* General button style for filter buttons */
            padding: 0.75rem 1.5rem; font-size: 1rem; border-radius: var(--border-radius-md);
            flex-shrink: 0; text-transform: none; letter-spacing: normal;
        }
        .btn-filter-action {
            background-color: var(--primary-color); color: var(--white-color);
        }
        .btn-filter-action:hover { background-color: var(--primary-darker); transform: translateY(-2px); }
        .btn-filter-reset {
             background-color: var(--text-light-color); color: var(--white-color);
        }
        .btn-filter-reset:hover { background-color: #5a6268; transform: translateY(-2px); }


        /* --- 8. Event Grid --- */
        .event-grid-container { margin-top: 30px; }
        .event-grid-title { font-size: 2.2rem; color: var(--primary-color); margin-bottom: 2rem; text-align: center; position:relative; padding-bottom:10px; }
        .event-grid-title::after { /* Subtle underline accent */
            content: ''; display:block; width:80px; height:4px;
            background-color: var(--accent-color);
            margin: 10px auto 0; border-radius:2px;
        }
        #eventGrid {
            display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 30px;
        }
        .event-card {
            background-color: var(--white-color); border-radius: var(--border-radius-lg);
            box-shadow: var(--card-shadow);
            display: flex; flex-direction: column;
            overflow: hidden;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            min-height: 420px; /* Ensure consistent height */
            position: relative;
            text-decoration: none; /* Remove underline if card is an <a> tag itself */
        }
        .event-card:hover {
            transform: translateY(-8px);
            box-shadow: var(--card-hover-shadow);
        }
        /* Optional: Add a colored top border accent based on event type or just a generic one */
        .event-card::before {
            content: ''; display: block; height: 6px;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color)); /* Default accent */
            /* Or dynamically set based on eventData.eventBadge for example */
        }
        .event-card.badge-new-card::before { background: var(--success-color); }
        .event-card.badge-popular-card::before { background: var(--accent-alt-color); }
        .event-card.badge-special-card::before { background: #8e44ad; }


        .event-card-content { padding: 25px; flex-grow: 1; display: flex; flex-direction: column; }
        .event-card-title { font-size: 1.5rem; color: #333; margin-bottom: 0.6rem; line-height: 1.35; }
        .event-card-date { font-size: 0.95rem; color: var(--primary-color); margin-bottom: 1rem; display: flex; align-items: center; font-weight:500;}
        .event-card-date i { margin-right: 10px; font-size: 1.1em; }
        .event-card-description {
            font-size: 1rem; color: var(--text-light-color); margin-bottom: 1.5rem;
            flex-grow: 1;
            overflow: hidden; display: -webkit-box;
            -webkit-line-clamp: 3; /* Show 3 lines */
            -webkit-box-orient: vertical;
            max-height: calc(1.7 * 1rem * 3); /* line-height * font-size * lines */
        }
        .event-card-footer {
            padding: 20px 25px; border-top: 1px solid #f0f0f0;
            margin-top: auto; /* Pushes footer to bottom */
            background-color: #fdfdfd;
        }
        .event-card-link {
            display: block; background-color: var(--primary-color); color: var(--white-color);
            padding: 12px 20px; border-radius: 50px; text-align: center;
            font-weight: 600; text-decoration: none;
            transition: background-color 0.2s ease, transform 0.2s ease;
            font-size: 1rem;
        }
        .event-card-link:hover { background-color: var(--primary-darker); text-decoration: none; color: var(--white-color); transform: scale(1.03); }
        .event-card-link i { margin-left: 10px; }

        /* Event Badges on Cards */
        .event-badges { display: flex; flex-wrap: wrap; gap: 6px; position: absolute; top: 18px; right: 18px; z-index: 5;}
        .badge {
            padding: 0.4em 0.9em; font-size: 0.7rem; font-weight: 700;
            border-radius: 50px; /* Pill shape badges */
            text-transform: uppercase; letter-spacing: 0.5px;
            color: var(--white-color);
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .badge-new { background-color: var(--success-color); } /* Green */
        .badge-paid { background-color: var(--danger-color); } /* Red */
        .badge-popular { background-color: var(--accent-alt-color); } /* Orange */
        .badge-special { background-color: #8e44ad; } /* Purple */
        .badge-promo { background-color: var(--secondary-color); } /* Teal */
        .badge-soon { background-color: var(--accent-color); color: #333;} /* Yellow */


        /* No Events Message & Loading */
        #eventGridStatus {
            text-align: center; padding: 50px 20px; background-color: var(--white-color);
            border-radius: var(--border-radius-lg); box-shadow: var(--card-shadow);
            color: var(--text-light-color); font-size: 1.2rem;
            min-height: 200px;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
        }
        #eventGridStatus i { font-size: 2.5rem; display: block; margin-bottom: 1.2rem; color: #bdc3c7; }
        .fa-spinner { animation: fa-spin 1.2s infinite linear; }
        @keyframes fa-spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }


        /* --- 9. Responsive --- */
        @media (max-width: 992px) {
            .hero-section h1 { font-size: 2.8rem; }
            .hero-section .subtitle { font-size: 1.2rem; }
            .event-grid { grid-template-columns: repeat(auto-fill, minmax(290px, 1fr)); }
            .filter-section { padding: 20px; }
        }
        @media (max-width: 768px) {
            html { font-size: 15px; }
            .main-title-page { font-size: 2.4rem; margin-bottom: 2rem; }
            .hero-section { padding: 60px 20px; }
            .hero-section h1 { font-size: 2.2rem; }
             .hero-section .subtitle { font-size: 1.1rem; }
            .cta-buttons { flex-direction: column; gap: 18px; }
            .btn { width: 100%; max-width: 350px; padding: 0.8rem 1.8rem;}
            .filter-section { flex-direction: column; align-items: stretch; }
            .filter-section .form-group { width: 100%; }
            .filter-section .btn { width: 100%; margin-top: 10px; }
            .event-grid { grid-template-columns: 1fr; gap: 25px; }
            .event-card { min-height: auto; }
            .lang-toggle { position: static; text-align: center; margin-bottom: 1.5rem; }

            .main-nav { display: none; flex-direction: column; position: absolute; top: 100%; left: 0; width: 100%; background-color: var(--white-color); box-shadow: 0 5px 10px rgba(0,0,0,0.1); padding: 10px 0; border-top: 1px solid #eee; }
            .main-nav.active { display: flex; }
            .main-nav ul { flex-direction: column; width: 100%; }
            .main-nav li { margin: 0; }
            .main-nav li a { display: block; padding: 12px 20px; border-bottom: 1px solid #f0f0f0; color: var(--text-color);}
            .main-nav li:last-child a { border-bottom: none; }
            .mobile-nav-toggle { display: block; }
        }
        @media (max-width: 480px) {
            .hero-section h1 { font-size: 2rem; }
            .hero-section .subtitle { font-size: 1rem; }
            .event-card-title { font-size: 1.3rem; }
            .event-card-description { -webkit-line-clamp: 2; max-height: calc(1.7 * 1rem * 2); }
            .btn { padding: 0.75rem 1.5rem; font-size: 1rem;}
        }
    </style>
</head>
<body>

    <div id="app-header">
        </div>

    <main class="container">
        <div class="lang-toggle">
            <a href="#" onclick="inlineIndexChangeLang('fr'); return false;" class="lang-link active" id="lang-fr-idx">FR</a> |
            <a href="#" onclick="inlineIndexChangeLang('en'); return false;" class="lang-link" id="lang-en-idx">EN</a>
        </div>

        <section class="hero-section">
            <h1 data-fr="Créez des Moments Inoubliables" data-en="Create Unforgettable Moments">Créez des Moments Inoubliables</h1>
            <p class="subtitle" data-fr="MonRdvFacile est votre partenaire privilégié pour l'organisation et la découverte d'événements à Royan et ses alentours. Simple, rapide et efficace." data-en="MyEasyMeeting is your preferred partner for organizing and discovering events in Royan and its surroundings. Simple, fast, and efficient.">MonRdvFacile est votre partenaire privilégié pour l'organisation et la découverte d'événements à Royan et ses alentours. Simple, rapide et efficace.</p>
            <div class="cta-buttons">
                <a href="create-event.html" class="btn btn-primary-cta"><i class="fas fa-plus-circle"></i> <span data-fr="Créer Mon Événement" data-en="Create My Event">Créer Mon Événement</span></a>
                 </div>
            <a href="edit-event.html" class="modify-event-link"><i class="fas fa-edit"></i> <span data-fr="Gérer un événement existant" data-en="Manage an existing event">Gérer un événement existant</span></a>
        </section>

        <section class="filter-section">
            <div class="form-group">
                <label for="searchName" data-fr="Rechercher par nom :" data-en="Search by name:">Rechercher par nom :</label>
                <input type="text" id="searchName" data-fr-placeholder="Nom de l'événement..." data-en-placeholder="Event name...">
            </div>
            <div class="form-group">
                <label for="searchDate" data-fr="À partir du :" data-en="From date:">À partir du :</label>
                <input type="date" id="searchDate">
            </div>
            <button type="button" id="applyFiltersButton" class="btn btn-filter-action"><i class="fas fa-filter"></i> <span data-fr="Filtrer" data-en="Filter">Filtrer</span></button>
            <button type="button" id="resetFiltersButton" class="btn btn-filter-reset"><i class="fas fa-undo"></i> <span data-fr="Réinitialiser" data-en="Reset">Réinitialiser</span></button>
        </section>

        <section class="event-grid-container">
            <h2 class="event-grid-title" data-fr="Découvrez les Événements à Venir" data-en="Discover Upcoming Events">Découvrez les Événements à Venir</h2>
            <div id="eventGrid">
                </div>
            <div id="eventGridStatus" style="display: none;">
                </div>
        </section>

    </main>

    <div id="app-footer">
        </div>

    <script src="src/hf.js"></script>
    <script>
    // --- MonRdvFacile - Inline JS for revamped index.html ---
    document.addEventListener('DOMContentLoaded', function() {
        let currentLangIdx = 'fr';
        const translatableElementsIdx = []; // To store elements that need translation
        const WORKER_API_URL = 'https://monrdvfacile-api.qmpro.workers.dev/api/events'; // Ensure this is your correct API endpoint

        function queryTranslatableElementsIdx() {
            translatableElementsIdx.length = 0; // Clear before repopulating
            document.querySelectorAll('[data-fr], [data-en], [data-fr-placeholder], [data-en-placeholder]').forEach(el => {
                const item = {
                    element: el,
                    frText: el.dataset.fr,
                    enText: el.dataset.en,
                    frPlaceholder: el.dataset.frPlaceholder,
                    enPlaceholder: el.dataset.enPlaceholder,
                    isTitle: el.tagName === 'TITLE',
                    isPlaceholder: el.hasAttribute('data-fr-placeholder') || el.hasAttribute('data-en-placeholder'),
                    isButtonSpan: (el.tagName === 'BUTTON' || el.tagName === 'A') && el.querySelector('span'),
                    isDirectButtonText: (el.tagName === 'BUTTON' || el.tagName === 'A') && !el.querySelector('span') && (el.dataset.fr || el.dataset.en)
                };
                if (!item.frText && !item.isPlaceholder && !(item.isButtonSpan || item.isDirectButtonText)) item.frText = el.textContent.trim();
                if (!item.enText && !item.isPlaceholder && !(item.isButtonSpan || item.isDirectButtonText)) item.enText = el.textContent.trim();

                translatableElementsIdx.push(item);
            });
        }

        function updateTextForLanguageIdx(lang) {
            currentLangIdx = lang;
            document.documentElement.lang = lang;
            translatableElementsIdx.forEach(item => {
                const text = lang === 'fr' ? item.frText : item.enText;
                const placeholderText = lang === 'fr' ? item.frPlaceholder : item.enPlaceholder;

                if (item.isTitle) { if (text) item.element.textContent = text; }
                else if (item.isPlaceholder) { if (placeholderText) item.element.placeholder = placeholderText; }
                else if (item.isButtonSpan) { const span = item.element.querySelector('span'); if (span && text) span.textContent = text; }
                else if (item.isDirectButtonText) {
                     const icon = item.element.querySelector('i');
                     if (icon) item.element.innerHTML = icon.outerHTML + " " + (text || ""); else if (text) item.element.textContent = text;
                }
                else { if (text) item.element.textContent = text; }
            });
            document.querySelectorAll('.lang-link').forEach(link => link.classList.remove('active'));
            const activeLink = document.getElementById(`lang-${lang}-idx`);
            if (activeLink) activeLink.classList.add('active');
            try { localStorage.setItem('preferredLang', lang); } catch (e) { console.warn("localStorage unavailable."); }
            
            loadAndDisplayEvents(); // Reload events as card text might change
        }

        window.inlineIndexChangeLang = function(lang) { // Expose to global
            if (lang !== currentLangIdx) { updateTextForLanguageIdx(lang); }
        };

        function detectLanguagePreferenceIdx() {
            try { const storedLang = localStorage.getItem('preferredLang'); if (storedLang && (storedLang === 'fr' || storedLang === 'en')) return storedLang; } catch (e) {}
            const browserLang = navigator.language || navigator.userLanguage; if (browserLang && browserLang.toLowerCase().startsWith('en')) return 'en'; return 'fr';
        }

        const eventGrid = document.getElementById('eventGrid');
        const eventGridStatus = document.getElementById('eventGridStatus');
        const searchNameInput = document.getElementById('searchName');
        const searchDateInput = document.getElementById('searchDate');
        const applyFiltersButton = document.getElementById('applyFiltersButton');
        const resetFiltersButton = document.getElementById('resetFiltersButton');

        const messagesIdx = {
            loading: {fr: "Chargement des événements...", en: "Loading events..."},
            noEvents: {fr: "Aucun événement trouvé.", en: "No events found."},
            noEventsCriteria: {fr: "Aucun événement ne correspond à vos critères de recherche.", en: "No events match your search criteria."},
            errorLoading: {fr: "Erreur lors du chargement des événements.", en: "Error loading events."},
            viewDetails: {fr: "Voir les Détails", en: "View Details"},
            eventUntitled: {fr: "Événement Sans Titre", en: "Untitled Event"},
            noDescription: {fr: "Pas de description disponible.", en: "No description available."},
            dateFrom: {fr: "Du", en: "From"},
            dateTo: {fr: "au", en: "to"},
            badgePaid: {fr: "Payant", en: "Paid"},
            badgeNew: {fr: "Nouveau", en: "New"},
            badgePopular: {fr: "Populaire", en: "Popular"},
            badgeSpecial: {fr: "Spécial", en: "Special"},
            badgePromo: {fr: "Promotion", en: "Promotion"},
            badgeSoon: {fr: "Bientôt Complet", en: "Nearly Full"}
        };

        function getMessageIdx(key, lang) {
            const l = lang || currentLangIdx;
            return (messagesIdx[key] ? messagesIdx[key][l] : key) || key;
        }

        function showStatusMessage(messageKey, type = 'info') {
            eventGridStatus.innerHTML = '';
            const icon = document.createElement('i');
            icon.className = type === 'loading' ? 'fas fa-spinner fa-spin' : (type === 'error' ? 'fas fa-exclamation-triangle' : 'fas fa-info-circle');
            eventGridStatus.appendChild(icon);
            const p = document.createElement('p');
            p.textContent = getMessageIdx(messageKey);
            eventGridStatus.appendChild(p);
            eventGridStatus.style.display = 'flex';
        }

        function formatEventDateRange(startDateStr, startTimeStr, endDateStr, endTimeStr, lang) {
            const locale = lang === 'fr' ? 'fr-FR' : 'en-US';
            const dateOptions = { weekday: 'short', year: 'numeric', month: 'short', day: 'numeric' };
            const timeOptions = { hour: '2-digit', minute: '2-digit' };

            const startDateTime = new Date(`${startDateStr}T${startTimeStr || '00:00'}`);
            const endDateTime = new Date(`${endDateStr}T${endTimeStr || '00:00'}`);

            if (isNaN(startDateTime.getTime())) return getMessageIdx('dateNotSpecified', lang);

            let formattedStart = startDateTime.toLocaleDateString(locale, dateOptions);
            if (startTimeStr && startTimeStr !== "00:00") formattedStart += `, ${startDateTime.toLocaleTimeString(locale, timeOptions)}`;
            
            if (startDateStr === endDateStr) { // Same day event
                 if (startTimeStr === endTimeStr || (!startTimeStr && !endTimeStr) || !endTimeStr ) {
                     return formattedStart; // Only show start if end time is same or not specified
                 }
                 return `${formattedStart} - ${endDateTime.toLocaleTimeString(locale, timeOptions)}`;
            } else { // Multi-day event
                let formattedEnd = endDateTime.toLocaleDateString(locale, dateOptions);
                if (endTimeStr && endTimeStr !== "00:00") formattedEnd += `, ${endDateTime.toLocaleTimeString(locale, timeOptions)}`;
                 return `${getMessageIdx('dateFrom', lang)} ${formattedStart} ${getMessageIdx('dateTo', lang)} ${formattedEnd}`;
            }
        }
        
        function getBadgeHTML(badgeKey, isPaid, lang) {
            let html = '';
            const badgeInfo = {
                new: { textKey: 'badgeNew', class: "badge-new" },
                popular: { textKey: 'badgePopular', class: "badge-popular" },
                special: { textKey: 'badgeSpecial', class: "badge-special" },
                promo: { textKey: 'badgePromo', class: "badge-promo" },
                soon: { textKey: 'badgeSoon', class: "badge-soon" }
            };

            if (badgeKey && badgeKey !== "none" && badgeInfo[badgeKey]) {
                const badge = badgeInfo[badgeKey];
                html += `<span class="badge ${badge.class}">${getMessageIdx(badge.textKey, lang)}</span>`;
            }
            if (isPaid === 1 || isPaid === true) {
                html += `<span class="badge badge-paid">${getMessageIdx('badgePaid', lang)}</span>`;
            }
            return html ? `<div class="event-badges">${html}</div>` : '';
        }


        function renderEventCard(eventData) {
            const cardLink = document.createElement('a'); // Make the whole card a link
            cardLink.href = `event-display.html?id=${eventData.id}`;
            cardLink.classList.add('event-card');
            cardLink.setAttribute('aria-label', `${eventData.eventName || getMessageIdx('eventUntitled')}. ${getMessageIdx('viewDetails')}`);
            
            // Add dynamic class for top border based on badge
            if (eventData.eventBadge && eventData.eventBadge !== 'none') {
                cardLink.classList.add(`badge-${eventData.eventBadge}-card`);
            }


            const badgesHTML = getBadgeHTML(eventData.eventBadge, eventData.isPaidEvent, currentLangIdx);
            const description = eventData.eventDescription || getMessageIdx('noDescription');
            const title = eventData.eventName || getMessageIdx('eventUntitled');
            const dateDisplay = formatEventDateRange(eventData.eventStartDate, eventData.eventStartTime, eventData.eventEndDate, eventData.eventEndTime, currentLangIdx);

            cardLink.innerHTML = `
                ${badgesHTML}
                <div class="event-card-content">
                    <h3 class="event-card-title">${title}</h3>
                    <p class="event-card-date"><i class="fas fa-calendar-alt"></i> ${dateDisplay}</p>
                    <p class="event-card-description">${description}</p>
                </div>
                <div class="event-card-footer">
                    <span class="event-card-link"> 
                        ${getMessageIdx('viewDetails')} <i class="fas fa-arrow-right"></i>
                    </span>
                </div>
            `;
            return cardLink;
        }

        async function loadAndDisplayEvents() {
            eventGrid.innerHTML = '';
            showStatusMessage('loading', 'loading');
            
            const params = new URLSearchParams();
            const nameVal = searchNameInput.value.trim();
            const dateVal = searchDateInput.value;

            if (nameVal) params.append('name', nameVal);
            if (dateVal) params.append('startDate', dateVal); // Assuming API filters by events starting on or after this date
            params.append('status', 'upcoming'); // Always fetch upcoming events for index

            const requestUrl = params.toString() ? `${WORKER_API_URL}?${params.toString()}` : `${WORKER_API_URL}?status=upcoming`;
            
            try {
                const response = await fetch(requestUrl);
                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(`API error: ${response.status} - ${errorText}`);
                }
                const result = await response.json(); // Assuming worker returns { success: true, events: [...] }

                if (result.success && result.events && result.events.length > 0) {
                    eventGridStatus.style.display = 'none';
                    // Sort events by start date (ascending, closest first) client-side if not done by API
                    result.events.sort((a,b) => new Date(a.eventStartDate + 'T' + (a.eventStartTime || '00:00')) - new Date(b.eventStartDate + 'T' + (b.eventStartTime || '00:00')));
                    result.events.forEach(eventData => {
                        eventData.isPaidEvent = (eventData.isPaidEvent === 1 || eventData.isPaidEvent === true);
                        eventGrid.appendChild(renderEventCard(eventData));
                    });
                } else {
                    showStatusMessage(nameVal || dateVal ? 'noEventsCriteria' : 'noEvents', 'info');
                }
            } catch (error) {
                console.error("Error fetching events:", error);
                showStatusMessage('errorLoading', 'error');
            }
        }
        
        applyFiltersButton.addEventListener('click', loadAndDisplayEvents);
        searchNameInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                loadAndDisplayEvents();
            }
        });
        resetFiltersButton.addEventListener('click', () => {
            searchNameInput.value = '';
            searchDateInput.value = '';
            // Restore placeholder text based on current language
            searchNameInput.placeholder = currentLangIdx === 'fr' ? "Nom de l'événement..." : "Event name...";
            loadAndDisplayEvents();
        });

        // --- Initial Page Setup ---
        queryTranslatableElementsIdx();
        const preferredLangIdx = detectLanguagePreferenceIdx();
        updateTextForLanguageIdx(preferredLangIdx); // This will also call loadAndDisplayEvents

        // hf.js handling
        if (typeof createHeader === "function" && typeof createFooter === "function") {
            createHeader('app-header', currentLangIdx); createFooter('app-footer', currentLangIdx);
        } else if (typeof loadHf === "function") { loadHf(currentLangIdx);
        } else { /* fallback */
             const headerDiv = document.getElementById('app-header'); const footerDiv = document.getElementById('app-footer');
             if(headerDiv && !headerDiv.innerHTML.trim()) headerDiv.innerHTML = `<div class="header-container"><div class="logo"><a href="index.html">MonRdvFacile</a></div><nav class="main-nav"><ul><li><a href="index.html">Accueil</a></li><li><a href="create-event.html">Créer</a></li></ul></nav><button class="mobile-nav-toggle"><i class="fas fa-bars"></i></button></div>`;
             if(footerDiv && !footerDiv.innerHTML.trim()) footerDiv.innerHTML = `<div class="footer-container"><p>&copy; ${new Date().getFullYear()} MonRdvFacile</p></div>`;
        }
        // Re-query and update after hf.js might have added elements
        setTimeout(() => { queryTranslatableElementsIdx(); updateTextForLanguageIdx(currentLangIdx); }, 200);

        console.log("Revamped index.html inline JS loaded.");
    });
    </script>
</body>
</html>
