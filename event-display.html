<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title data-fr="Détails de l'Événement - MonRdvFacile" data-en="Event Details - MyEasyMeeting">Détails de l'Événement</title>
    <meta id="metaDescription" name="description" content="" data-fr-base="Consultez les détails pour {eventName} et inscrivez-vous." data-en-base="View details for {eventName} and register.">
    <meta name="keywords" content="événement, inscription, royan, 17000, charente-maritime, mon rdv facile">
    <meta name="robots" content="index, follow">
    <link id="canonicalLink" rel="canonical" href="">

    <meta id="ogType" property="og:type" content="article">
    <meta id="ogUrl" property="og:url" content="">
    <meta id="ogTitle" property="og:title" content="">
    <meta id="ogDescription" property="og:description" content="">
    <meta property="og:site_name" content="MonRdvFacile">
    <meta id="ogLocale" property="og:locale" content="fr_FR">

    <meta id="twitterCard" name="twitter:card" content="summary">
    <meta id="twitterUrl" name="twitter:url" content="">
    <meta id="twitterTitle" name="twitter:title" content="">
    <meta id="twitterDescription" name="twitter:description" content="">

    <script async src="https://www.googletagmanager.com/gtag/js?id=G-K2JVSXZXNN"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-K2JVSXZXNN');
    </script>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" xintegrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A==" crossorigin="anonymous" referrerpolicy="no-referrer" />

    <style>
        /* --- Inline CSS for event-display.html (Production Polish) --- */
        :root {
            --primary-color-display: #005A9C; /* Main theme blue */
            --primary-darker-display: #004170;
            --secondary-color-display: #17a2b8; /* Teal for accents */
            --success-color-display: #28a745; /* Green for success */
            --danger-color-display: #dc3545;  /* Red for errors */
            --info-color-display: #0dcaf0; /* Light blue for info badges */
            --text-color-display: #333333;
            --text-light-display: #555555;
            --bg-color-display: #F8F9FA;
            --content-bg-display: #FFFFFF;
            --border-color-display: #CED4DA;
            --border-radius-display: 8px;
            --box-shadow-display: 0 4px 15px rgba(0, 0, 0, 0.08);
        }

        *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
        html { font-size: 16px; scroll-behavior: smooth; -webkit-text-size-adjust: 100%; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
            line-height: 1.65; background-color: var(--bg-color-display); color: var(--text-color-display);
            display: flex; flex-direction: column; min-height: 100vh;
            -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale;
        }
        h1, h2, h3, h4 { font-weight: 600; color: var(--primary-darker-display); margin-bottom: 0.85rem; line-height: 1.3; }
        h1.event-title-main { font-size: 2.6rem; color: var(--primary-color-display); text-align: center; margin-top: 1.2rem; margin-bottom: 0.6rem; word-break: break-word;}
        h2 { font-size: 1.8rem; }
        h3 { font-size: 1.6rem; margin-top: 1.8rem; border-bottom: 2px solid var(--primary-color-display); padding-bottom: 0.6rem; color: var(--primary-color-display);}
        p { margin-bottom: 1.1rem; font-size: 1.1rem; color: var(--text-light-display); }
        a { color: var(--primary-color-display); text-decoration: none; }
        a:hover, a:focus { color: var(--primary-darker-display); text-decoration: underline; }

        .container { width: 90%; max-width: 960px; margin-left: auto; margin-right: auto; padding: 25px 15px; }
        main.container { flex-grow: 1; }

        #app-header {}
        #app-footer { margin-top: auto; }

        .lang-toggle { text-align: right; margin-bottom: 1rem; font-size: 0.9rem; }
        .lang-link { color: var(--text-light-display); text-decoration: none; padding: 0.3rem 0.5rem; border-radius: 4px; cursor:pointer; font-weight: 500; }
        .lang-link.active { font-weight: bold; color: var(--primary-color-display); background-color: rgba(0, 90, 156, 0.1); }
        .lang-link:hover { background-color: rgba(0, 90, 156, 0.07); }

        .content-section { background-color: var(--content-bg-display); padding: 30px; border-radius: var(--border-radius-display); box-shadow: var(--box-shadow-display); margin-top: 25px; margin-bottom: 35px; }
        
        .event-meta p { margin-bottom: 0.7rem; font-size: 1.15rem; color: var(--text-color-display); display:flex; align-items: flex-start;}
        .event-meta p i { margin-right: 10px; color: var(--primary-color-display); width:20px; text-align:center; margin-top: 0.15em; /* Align icon better with text */ }
        .event-meta strong { color: var(--primary-darker-display); margin-right: 5px;}
        .event-description-text { font-size: 1.2rem; margin-top: 15px; margin-bottom: 25px; white-space: pre-wrap; line-height: 1.7; }

        .badge-display-wrapper { text-align: center; margin-bottom: 1.5rem; display: flex; flex-wrap: wrap; justify-content: center; gap: 10px;}
        .badge-display { display: inline-block; padding: 0.5em 1em; font-size: 0.9rem; font-weight: 600; line-height: 1; color: #fff; text-align: center; white-space: nowrap; vertical-align: middle; border-radius: 50px; }
        .badge-new { background-color: var(--secondary-color-display); }
        .badge-popular { background-color: var(--danger-color-display); }
        .badge-special { background-color: #fd7e14; }
        .badge-promo { background-color: #6f42c1; }
        .badge-soon { background-color: #ffc107; color:#212529 !important; }
        .badge-afa { background-color: #E4002B; } /* AFA Red */
        .badge-online { background-color: var(--info-color-display); color:#212529 !important;}
        .badge-paid { background-color: var(--success-color-display); }
        .badge-none { display:none; }

        #eventTableLayout, #eventLocationSection, #detailedMenuDisplaySection { margin-top: 25px; padding: 20px; border: 1px solid #e0e0e0; border-radius: var(--border-radius-display); background-color: #fdfdfd; }
        #eventTableLayout h4, #eventLocationSection h4, #detailedMenuDisplaySection h4 { margin-top:0; font-size: 1.3rem; color: var(--primary-darker-display); text-align:center; margin-bottom:20px;}
        .tables-display-container { display: flex; flex-wrap: wrap; gap: 20px; justify-content: center; }
        .display-table-box { border: 1px solid var(--primary-color-display); border-radius: var(--border-radius-display); padding: 12px 15px; background-color: #edf6ff; text-align: center; min-width: 130px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .display-table-box strong { color: var(--primary-darker-display); font-size:1.1rem; }
        .display-table-chairs { font-size: 0.95em; color: var(--text-light-display); }
        
        .location-detail { margin-bottom: 10px; font-size: 1.1rem; }
        .location-detail i { margin-right: 8px; color: var(--primary-color-display); }
        .gmap-link { display: inline-block; margin-top: 5px; padding: 8px 15px; background-color: var(--primary-color-display); color: white; border-radius: 4px; text-decoration: none; }
        .gmap-link:hover { background-color: var(--primary-darker-display); }

        /* Detailed Menu Display */
        .menu-display-section { margin-bottom: 20px; }
        .menu-display-section h5 { font-size: 1.2rem; color: var(--primary-color-display); margin-bottom: 10px; border-bottom: 1px solid #eee; padding-bottom: 5px;}
        .menu-display-section ul { list-style: none; padding-left: 0; }
        .menu-display-section li {
            padding: 5px 0;
            font-size: 1.05rem;
            display: flex;
            justify-content: space-between;
        }
        .menu-item-name { flex-grow: 1; }
        .menu-item-price { font-weight: 500; color: var(--text-color-display); margin-left:15px; }


        .registration-form legend { font-size: 1.3rem; font-weight: 600; color: var(--primary-darker-display); padding: 0 10px; margin-left: 5px; }
        .form-group { margin-bottom: 1.8rem; }
        label { display: block; font-weight: 500; color: var(--text-color-display); margin-bottom: 0.7rem; font-size: 1.15rem; }
        input[type="text"], input[type="email"], input[type="tel"], select {
            width: 100%; padding: 0.9rem 1.2rem; font-size: 1.1rem; 
            line-height: 1.5; color: #495057; background-color: var(--content-bg-display);
            border: 1px solid var(--border-color-display); border-radius: var(--border-radius-display); box-shadow: inset 0 1px 3px rgba(0,0,0,0.06);
            transition: border-color 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
        }
        input:focus, select:focus { border-color: var(--primary-color-display); outline: 0; box-shadow: 0 0 0 0.25rem rgba(0, 90, 156, 0.2); }
        .form-error-text { display: block; margin-top: 0.4rem; font-size: 0.9rem; color: var(--danger-color-display); font-weight:500; }
        .mandatory-star { color: var(--danger-color-display); font-weight: bold; margin-left: 3px; }

        .paid-options-group { margin-top:1.2rem; padding: 20px; background-color: #edf6ff; border: 1px solid #b8d4f1; border-radius: var(--border-radius-display);}
        .paid-options-group legend { font-size: 1.2rem; color: var(--primary-darker-display); }
        .paid-options-group .form-group-radio { display: flex; align-items: center; margin-bottom: 0.7rem; }
        .paid-options-group input[type="radio"] { width: auto; margin-right: 12px; transform: scale(1.5); accent-color: var(--primary-color-display); cursor:pointer;}
        .paid-options-group label { margin-bottom: 0; font-weight: normal; font-size: 1.1rem; cursor:pointer;}

        .form-actions { margin-top: 2.5rem; padding-top: 2rem; border-top: 1px solid #e9ecef; text-align: center;}
        .btn-submit-registration {
            background-color: var(--success-color-display); border:none; color: white;
            padding: 0.9rem 2rem; font-size: 1.25rem; border-radius: 50px;
            transition: background-color 0.2s ease, transform 0.2s ease; font-weight: 600;
        }
        .btn-submit-registration:hover { background-color: #218838; transform: translateY(-2px); }
        .btn-submit-registration:disabled { background-color: #aaa; cursor: not-allowed; }
        .btn-submit-registration i { margin-right: 0.8rem; }

        #registrationConfirmationMessage { padding: 25px; background-color: #e6ffed; border: 1px solid #a3e9b8; border-radius: var(--border-radius-display); margin-top:25px; text-align:center; display:none; }
        #registrationConfirmationMessage h3 { color: #0f5132; font-size:1.8rem; margin-bottom:15px;}
        #confirmationDetails p { margin-bottom: 0.6rem; font-size: 1.15rem; color: var(--text-color-display) }
        #confirmationDetails strong {color: var(--primary-darker-display); }
        .print-button { margin-top:20px; padding:12px 20px; background-color:var(--primary-color-display); color:white; border:none; border-radius:50px; cursor:pointer; font-size: 1.05rem; font-weight:500;}
        .print-button:hover { background-color: var(--primary-darker-display); }

        .share-section { margin-top: 35px; padding-top: 25px; border-top: 1px solid #e9ecef; text-align: center; }
        .share-section h3 { font-size:1.5rem; color: var(--primary-darker-display); margin-bottom:15px; }
        .share-button {
            display: inline-flex; align-items:center; justify-content:center; gap: 8px;
            margin: 10px; padding: 12px 25px; border-radius: 50px;
            text-decoration: none; font-size: 1.1rem; transition: background-color 0.2s ease, transform 0.2s ease; font-weight:500;
        }
        .copy-link-btn { background-color: var(--primary-color-display); color:white; }
        .whatsapp-btn { background-color: #25D366; color:white; }
        .copy-link-btn:hover { background-color: var(--primary-darker-display); transform: translateY(-2px); }
        .whatsapp-btn:hover { background-color: #1DA851; transform: translateY(-2px); }
        #copyStatusMessage { font-size:0.9em; margin-top:8px; color: var(--primary-color-display); height: 1.2em; }

        .general-message { padding: 20px; margin-bottom: 25px; border-radius: var(--border-radius-display); border: 1px solid transparent; font-size: 1.1rem; display: none; text-align:center; font-weight:500;}
        .general-message-error { color: #721C24; background-color: #F8D7DA; border-color: #F5C6CB; }
        .general-message-success { color: #155724; background-color: #D4EDDA; border-color: #C3E6CB; }
        .general-message-loading { color: #0C5460; background-color: #D1ECF1; border-color: #BEE5EB; }
        .general-message i { margin-right: 8px;}

        @media (max-width: 768px) { /* ... (Keep existing responsive styles) ... */ }
        @media (max-width: 480px) { /* ... (Keep existing responsive styles) ... */ }

        @media print {
            body { background-color: #fff; color: #000; font-size: 11pt; line-height: 1.4;}
            #app-header, #app-footer, .lang-toggle, .registration-form, .share-section, .print-button, #generalMessageArea, .event-meta h2, #eventTableLayout h4, #detailedMenuDisplaySection h4, #registrationFormHeading {
                display: none !important;
            }
            main.container { margin: 20px; padding:0; width: auto; max-width:100%;}
            .content-section, #eventTableLayout, #detailedMenuDisplaySection {
                box-shadow: none; border: 1px solid #ccc; padding: 15px; margin-top:15px; margin-bottom:15px;
            }
            h1.event-title-main { font-size: 1.8rem; margin-bottom: 10px; }
            .badge-display-wrapper { margin-bottom: 10px; }
            .badge-display { font-size: 0.8rem; padding: 0.3em 0.6em; border: 1px solid #ccc; color: #333 !important; background-color: #eee !important;}
            .event-meta p, .event-description-text { font-size: 1rem; }
            .menu-display-section h5 { font-size: 1.1rem; }
            .menu-display-section li { font-size: 1rem; }
            #registrationConfirmationMessage { border: none; padding: 0; margin-top: 10px; }
            #registrationConfirmationMessage h3 { font-size: 1.5rem; color: #000; }
            #confirmationDetails p { font-size: 1rem; }
            a { color: #000 !important; text-decoration: none !important; }
            a[href]::after { content: " (" attr(href) ")"; font-size: 0.8em; color: #555; }
        }

    </style>
</head>
<body>

    <div id="app-header"></div>

    <main class="container">
        <div class="lang-toggle">
            <a href="#" onclick="switchLanguageDisplay('fr'); return false;" class="lang-link active" id="lang-fr-display" aria-label="Passer en Français">FR</a> |
            <a href="#" onclick="switchLanguageDisplay('en'); return false;" class="lang-link" id="lang-en-display" aria-label="Switch to English">EN</a>
        </div>

        <div id="generalMessageArea" class="general-message" role="alert"></div>

        <article id="eventContent" style="display:none;">
            <header>
                <h1 id="eventTitle" class="event-title-main"></h1>
                <div id="eventBadgeDisplayWrapper" class="badge-display-wrapper">
                    </div>
            </header>

            <section class="content-section event-meta" aria-labelledby="eventInfoHeading">
                <h2 id="eventInfoHeading" data-fr="Informations sur l'Événement" data-en="Event Information">Informations</h2>
                <p id="organizerDisplay" style="display:none;"><i class="fas fa-user-tie" aria-hidden="true"></i><strong><span data-fr="Organisé par :" data-en="Organized by:">Organisé par :</span></strong> <span id="eventOrganizerName"></span></p>
                <p><i class="fas fa-calendar-alt" aria-hidden="true"></i><strong><span data-fr="Date de début :" data-en="Start Date:">Date de début :</span></strong> <time id="eventStartDate"></time></p>
                <p><i class="fas fa-calendar-check" aria-hidden="true"></i><strong><span data-fr="Date de fin :" data-en="End Date:">Date de fin :</span></strong> <time id="eventEndDate"></time></p>
                <p id="eventStartTimeDisplayRow"><i class="fas fa-clock" aria-hidden="true"></i><strong><span data-fr="Heure de début :" data-en="Start Time:">Heure de début :</span></strong> <time id="eventStartTime"></time></p>
                <p id="eventEndTimeDisplayRow"><i class="fas fa-clock" aria-hidden="true"></i><strong><span data-fr="Heure de fin :" data-en="End Time:">Heure de fin :</span></strong> <time id="eventEndTime"></time></p>
                <p><i class="fas fa-user-clock" aria-hidden="true"></i><strong><span data-fr="Date limite d'inscription :" data-en="Registration Deadline:">Date limite d'inscription :</span></strong> <time id="eventDeadline"></time></p>
                <p id="eventPriceDisplay" style="display:none;"><i class="fas fa-euro-sign" aria-hidden="true"></i><strong><span data-fr="Prix :" data-en="Price:">Prix :</span></strong> <span id="eventPrice"></span></p>
                
                <div id="locationInfoSection">
                    </div>
                <p id="seatSelectionInfo" style="display:none;"><i class="fas fa-chair" aria-hidden="true"></i><strong><span data-fr="Sélection des places :" data-en="Seat Selection:">Sélection des places :</span></strong> <span id="seatSelectionStatus"></span></p>

                <h3 data-fr="Description" data-en="Description" style="margin-top:1.8rem;">Description</h3>
                <p id="eventDescription" class="event-description-text"></p>
            </section>

            <section id="detailedMenuDisplaySection" class="content-section" style="display:none;" aria-labelledby="menuHeading">
                <h4 id="menuHeading" data-fr="Menu Proposé" data-en="Offered Menu">Menu Proposé</h4>
                <div id="detailedMenuContainer">
                    </div>
            </section>

            <section id="eventTableLayout" class="content-section" aria-labelledby="tableLayoutHeading" style="display:none;">
                <h4 id="tableLayoutHeading" data-fr="Aménagement Prévu" data-en="Planned Layout">Aménagement Prévu</h4>
                <div id="tablesDisplayContainer" class="tables-display-container"></div>
                <p id="totalCapacityInfo" style="text-align:center; margin-top:15px; font-size:1.05rem; font-weight:500;"></p>
            </section>

            <section class="content-section registration-form" aria-labelledby="registrationFormHeading">
                <h2 id="registrationFormHeading" data-fr="Inscrivez-vous Maintenant !" data-en="Register Now!">Inscrivez-vous Maintenant !</h2>
                <form id="registrationForm" novalidate>
                    <fieldset>
                        <legend data-fr="Vos Coordonnées" data-en="Your Details">Vos Coordonnées</legend>
                        <div class="form-group">
                            <label for="userName"><span data-fr="Nom complet" data-en="Full Name">Nom complet</span> <span class="mandatory-star" aria-hidden="true">*</span></label>
                            <input type="text" id="userName" name="userName" required maxlength="100" autocomplete="name" aria-describedby="userNameError">
                            <small class="form-error-text" id="userNameError" role="alert"></small>
                        </div>
                        <div class="form-group">
                            <label for="userEmail"><span data-fr="Adresse e-mail" data-en="Email Address">Adresse e-mail</span> <span class="mandatory-star" aria-hidden="true">*</span></label>
                            <input type="email" id="userEmail" name="userEmail" required maxlength="100" autocomplete="email" inputmode="email" aria-describedby="userEmailError">
                            <small class="form-error-text" id="userEmailError" role="alert"></small>
                        </div>
                        <div class="form-group">
                            <label for="userPhone"><span data-fr="Numéro de téléphone" data-en="Phone Number">Numéro de téléphone</span> <span class="mandatory-star" aria-hidden="true">*</span></label>
                            <input type="tel" id="userPhone" name="userPhone" required maxlength="20" autocomplete="tel" inputmode="tel" aria-describedby="userPhoneError">
                            <small class="form-error-text" id="userPhoneError" role="alert"></small>
                        </div>
                    </fieldset>

                    <fieldset id="menuSelectionGroup" style="display:none;">
                        <legend data-fr="Choix du Menu (Simple)" data-en="Menu Choice (Simple)">Choix du Menu (Simple)</legend>
                        <div class="form-group">
                            <label for="menuChoice"><span data-fr="Sélectionnez votre menu" data-en="Select your menu">Sélectionnez votre menu</span> <span class="mandatory-star" aria-hidden="true">*</span></label>
                            <select id="menuChoice" name="menuChoice" aria-describedby="menuChoiceError"></select>
                            <small class="form-error-text" id="menuChoiceError" role="alert"></small>
                        </div>
                    </fieldset>
                    
                    <div id="detailedMenuSelectionFormArea" style="display:none;">
                        <p data-fr="La sélection détaillée du menu sera disponible prochainement." data-en="Detailed menu selection will be available soon."></p>
                    </div>


                    <fieldset id="paymentOptionsGroup" class="paid-options-group" style="display:none;">
                        <legend data-fr="Confirmation de Paiement" data-en="Payment Confirmation">Confirmation de Paiement</legend>
                        <div class="form-group" role="radiogroup" aria-labelledby="paymentQuestionLabel">
                            <p id="paymentInstructions" style="font-size:1rem; margin-bottom:15px;"></p>
                            <span id="paymentQuestionLabel" class="form-label-like"><span data-fr="Avez-vous déjà réglé votre participation ?" data-en="Have you already paid for your participation?">Avez-vous déjà réglé ?</span> <span class="mandatory-star" aria-hidden="true">*</span></span>
                            <div class="form-group-radio">
                                <input type="radio" id="paidYes" name="paidStatus" value="yes" required aria-describedby="paidStatusError">
                                <label for="paidYes" data-fr="Oui" data-en="Yes">Oui</label>
                            </div>
                            <div class="form-group-radio">
                                <input type="radio" id="paidNo" name="paidStatus" value="no">
                                <label for="paidNo" data-fr="Non" data-en="No">Non</label>
                            </div>
                             <small class="form-error-text" id="paidStatusError" role="alert"></small>
                        </div>
                    </fieldset>

                    <div class="form-actions">
                        <button type="submit" class="btn btn-submit-registration" id="submitRegistrationBtn"><i class="fas fa-calendar-check"></i> <span data-fr="S'inscrire" data-en="Register">S'inscrire</span></button>
                    </div>
                </form>
            </section>

            <div id="registrationConfirmationMessage" role="alert">
                <h3 data-fr="Inscription Confirmée !" data-en="Registration Confirmed!">Inscription Confirmée !</h3>
                <div id="confirmationDetails"></div>
                <button type="button" onclick="window.print();" class="print-button print-button-itself"><i class="fas fa-print"></i> <span data-fr="Imprimer" data-en="Print">Imprimer</span></button>
            </div>

            <section class="share-section" aria-labelledby="shareHeading">
                <h3 id="shareHeading" data-fr="Partagez cet Événement !" data-en="Share this Event!">Partagez cet Événement !</h3>
                <button type="button" id="copyLinkButton" class="share-button copy-link-btn"><i class="fas fa-copy"></i> <span data-fr="Copier Lien" data-en="Copy Link">Copier Lien</span></button>
                <a id="whatsappShareLink" href="#" class="share-button whatsapp-btn" target="_blank" rel="noopener noreferrer"><i class="fab fa-whatsapp"></i> <span data-fr="WhatsApp" data-en="WhatsApp">WhatsApp</span></a>
                <p id="copyStatusMessage" aria-live="polite"></p>
            </section>
        </article> 
    </main>

    <div id="app-footer"></div>

    <script src="src/hf.js"></script>
    <script>
    // --- MonRdvFacile - Inline JS for event-display.html (v2 - Enhanced Features) ---
    document.addEventListener('DOMContentLoaded', function() {
        const WORKER_EVENT_URL = 'https://monrdvfacile-api.qmpro.workers.dev/api/events';
        const WORKER_REGISTER_URL = 'https://monrdvfacile-api.qmpro.workers.dev/api/register';

        let currentLangDisplay = 'fr';
        let currentEventData = null;

        const ui = {
            generalMessageArea: document.getElementById('generalMessageArea'),
            eventContentDiv: document.getElementById('eventContent'),
            eventTitleEl: document.getElementById('eventTitle'),
            eventBadgeDisplayWrapper: document.getElementById('eventBadgeDisplayWrapper'),
            organizerDisplay: document.getElementById('organizerDisplay'),
            eventOrganizerName: document.getElementById('eventOrganizerName'),
            eventStartDateEl: document.getElementById('eventStartDate'),
            eventEndDateEl: document.getElementById('eventEndDate'),
            eventStartTimeDisplayRow: document.getElementById('eventStartTimeDisplayRow'),
            eventStartTimeEl: document.getElementById('eventStartTime'),
            eventEndTimeDisplayRow: document.getElementById('eventEndTimeDisplayRow'),
            eventEndTimeEl: document.getElementById('eventEndTime'),
            eventDeadlineEl: document.getElementById('eventDeadline'),
            eventPriceDisplayEl: document.getElementById('eventPriceDisplay'),
            eventPriceEl: document.getElementById('eventPrice'),
            locationInfoSection: document.getElementById('locationInfoSection'), // Container for location details
            seatSelectionInfo: document.getElementById('seatSelectionInfo'),
            seatSelectionStatus: document.getElementById('seatSelectionStatus'),
            eventDescriptionEl: document.getElementById('eventDescription'),
            detailedMenuDisplaySection: document.getElementById('detailedMenuDisplaySection'),
            detailedMenuContainer: document.getElementById('detailedMenuContainer'),
            eventTableLayout: document.getElementById('eventTableLayout'),
            tablesDisplayContainerEl: document.getElementById('tablesDisplayContainer'),
            totalCapacityInfoEl: document.getElementById('totalCapacityInfo'),
            registrationForm: document.getElementById('registrationForm'),
            menuSelectionGroup: document.getElementById('menuSelectionGroup'), // Old simple menu
            menuChoiceSelect: document.getElementById('menuChoice'),         // Old simple menu select
            detailedMenuSelectionFormArea: document.getElementById('detailedMenuSelectionFormArea'), // For future complex menu selection
            paymentOptionsGroup: document.getElementById('paymentOptionsGroup'),
            paymentInstructionsEl: document.getElementById('paymentInstructions'),
            registrationConfirmationMessageEl: document.getElementById('registrationConfirmationMessage'),
            confirmationDetailsEl: document.getElementById('confirmationDetails'),
            copyLinkButton: document.getElementById('copyLinkButton'),
            whatsappShareLink: document.getElementById('whatsappShareLink'),
            copyStatusMessageEl: document.getElementById('copyStatusMessage'),
            metaDescriptionTag: document.getElementById('metaDescription'),
            canonicalLinkTag: document.getElementById('canonicalLink'),
            ogTitleTag: document.getElementById('ogTitle'),
            ogDescriptionTag: document.getElementById('ogDescription'),
            ogUrlTag: document.getElementById('ogUrl'),
            ogLocaleTag: document.getElementById('ogLocale'),
            twitterTitleTag: document.getElementById('twitterTitle'),
            twitterDescriptionTag: document.getElementById('twitterDescription'),
            twitterUrlTag: document.getElementById('twitterUrl'),
        };

        const errorFieldMapDisplay = {
            userName: 'userNameError', userEmail: 'userEmailError', userPhone: 'userPhoneError',
            menuChoice: 'menuChoiceError', paidStatus: 'paidStatusError'
        };
        
        const translatableItemsDisplay = [];
        function queryTranslatableItemsDisplay() { /* ... (Keep existing robust query logic) ... */
            translatableItemsDisplay.length = 0;
            document.querySelectorAll('[data-fr], [data-en], [data-fr-base], [data-en-base], [data-fr-placeholder], [data-en-placeholder]').forEach(el => {
                translatableItemsDisplay.push({
                    element: el, frText: el.dataset.fr, enText: el.dataset.en,
                    frBase: el.dataset.frBase, enBase: el.dataset.enBase,
                    frPlaceholder: el.dataset.frPlaceholder, enPlaceholder: el.dataset.enPlaceholder,
                    isTitleTag: el.tagName === 'TITLE',
                    isMetaContent: el.tagName === 'META' && el.hasAttribute('content'),
                    isInputPlaceholder: el.tagName === 'INPUT' && (el.dataset.frPlaceholder || el.dataset.enPlaceholder),
                    isButtonSpan: (el.tagName === 'BUTTON' || el.tagName === 'A') && el.querySelector('span:not([id])')
                });
            });
        }

        function updateUIDisplayLanguage(lang) { /* ... (Keep existing robust update logic) ... */
            currentLangDisplay = lang; document.documentElement.lang = lang;
            ui.ogLocaleTag.content = lang === 'fr' ? 'fr_FR' : 'en_US';
            translatableItemsDisplay.forEach(item => {
                let text = lang === 'fr' ? item.frText : item.enText;
                let baseText = lang === 'fr' ? item.frBase : item.enBase;
                const placeholderText = lang === 'fr' ? item.frPlaceholder : item.enPlaceholder;
                if (item.isTitleTag) { if (text) item.element.textContent = text; }
                else if (item.isMetaContent && baseText && currentEventData) { item.element.setAttribute('content', baseText.replace('{eventName}', currentEventData.eventName)); }
                else if (item.isMetaContent && text) { item.element.setAttribute('content', text); }
                else if (item.isInputPlaceholder) { if (placeholderText) item.element.placeholder = placeholderText; }
                else if (item.isButtonSpan) { const span = item.element.querySelector('span:not([id])'); if (span && text) span.textContent = text; }
                else { if (text && typeof item.element.textContent !== 'undefined') item.element.textContent = text; }
            });
            document.querySelectorAll('.lang-link').forEach(link => link.classList.remove('active'));
            const activeLink = document.getElementById(`lang-${lang}-display`); if (activeLink) activeLink.classList.add('active');
            try { localStorage.setItem('preferredLang', lang); } catch (e) {}
            if (currentEventData) { populateEventDetails(currentEventData); updateMetaTags(currentEventData); validateRegistrationForm(false); }
        }
        
        function detectLanguagePreferenceDisplay() { /* ... (Keep existing) ... */
            try { const storedLang = localStorage.getItem('preferredLang'); if (storedLang && (storedLang === 'fr' || storedLang === 'en')) return storedLang; } catch (e) {}
            const browserLang = navigator.language || navigator.userLanguage; if (browserLang && browserLang.toLowerCase().startsWith('en')) return 'en'; return 'fr';
        }
        window.switchLanguageDisplay = function(lang) { if (lang !== currentLangDisplay) { queryTranslatableItemsDisplay(); updateUIDisplayLanguage(lang); } };

        const messagesDisplay = { /* ... (Keep existing, add new keys as needed) ... */
            loading: { fr: "Chargement...", en: "Loading..." },
            eventNotFound: { fr: "Événement non trouvé.", en: "Event not found." },
            apiError: { fr: "Erreur serveur.", en: "Server error." },
            registrationSuccess: { fr: "Inscription réussie !", en: "Registration successful!" },
            addedToWaitlist: { fr: "Événement complet. Vous avez été ajouté à la liste d'attente.", en: "Event full. You've been added to the waitlist."},
            registrationError: { fr: "Erreur d'inscription.", en: "Registration error." },
            formErrors: { fr: "Corrigez les erreurs.", en: "Correct the errors." },
            required: { fr: "Requis.", en: "Required." },
            emailInvalid: { fr: "Email invalide.", en: "Invalid email." },
            phoneInvalid: { fr: "Téléphone invalide.", en: "Invalid phone." },
            menuRequired: { fr: "Choix de menu requis.", en: "Menu choice required." },
            paymentOptionRequired: { fr: "Statut paiement requis.", en: "Payment status required." },
            linkCopied: { fr: "Lien copié !", en: "Link copied!" },
            errorCopying: { fr: "Erreur copie.", en: "Copy error." },
            totalCapacityText: { fr: "Capacité: {capacity} places ({tables} tables × {chairs} chaises/table).", en: "Capacity: {capacity} seats ({tables} tables × {chairs} chairs/table)." },
            tableLabel: {fr: "Table", en: "Table"},
            chairsLabel: {fr: "chaises", en: "chairs"},
            paymentInstructionText: {fr: "Événement payant. Coût : {price}.", en: "Paid event. Cost: {price}."},
            selectMenuDefault: {fr: "-- Choisissez un menu --", en: "-- Select a menu --"},
            confirmName: {fr: "Nom :", en: "Name:"}, confirmEmail: {fr: "Email :", en: "Email:"},
            confirmPhone: {fr: "Téléphone :", en: "Phone:"}, confirmMenu: {fr: "Menu :", en: "Menu:"},
            confirmPaidStatus: {fr: "Paiement :", en: "Payment:"},
            paidStatusYes: {fr: "Déjà payé", en: "Already paid"},
            paidStatusNo: {fr: "Paiera sur place", en: "Will pay on site"},
            pageTitleSuffixFR: "Détails - MonRdvFacile", pageTitleSuffixEN: "Details - MyEasyMeeting",
            venueNameLabel: {fr: "Lieu :", en: "Venue:"},
            addressLabel: {fr: "Adresse :", en: "Address:"},
            gmapLinkText: {fr: "Voir sur Google Maps", en: "View on Google Maps"},
            onlineEventLabel: {fr: "Événement en ligne :", en: "Online Event:"},
            meetingLinkLabel: {fr: "Lien de la réunion :", en: "Meeting Link:"},
            joinMeetingText: {fr: "Rejoindre la réunion", en: "Join Meeting"},
            seatSelectionAllowed: {fr: "Oui, choix à l'inscription.", en: "Yes, choice during registration."},
            seatSelectionNotAllowed: {fr: "Non, placement libre/assigné.", en: "No, free/assigned seating."},
            joinMeAt: {fr: "Rejoignez-moi à ", en: "Join me at "} // For WhatsApp
        };
        function getMessageDisplay(key, replacements = {}) { /* ... (Keep existing) ... */
             let messageSet = messagesDisplay[key]; if (!messageSet && typeof key === 'string') return key;
             if (!messageSet) return `Missing Display: ${key}`; let message = messageSet[currentLangDisplay] || messageSet['fr'] || key;
             for (const placeholder in replacements) { message = message.replace(`{${placeholder}}`, replacements[placeholder]); } return message;
        }
        function showGeneralMessage(messageKey, type = 'error', replacements = {}) { /* ... (Keep) ... */
            ui.generalMessageArea.innerHTML = `<i class="fas ${type === 'loading' ? 'fa-spinner fa-spin' : (type === 'error' ? 'fa-exclamation-triangle' : 'fa-info-circle')}"></i> ${getMessageDisplay(messageKey, replacements)}`;
            ui.generalMessageArea.className = `general-message general-message-${type}`; ui.generalMessageArea.style.display = 'block'; ui.generalMessageArea.setAttribute('role', type === 'error' ? 'alert' : 'status');
        }
        function hideGeneralMessage() { ui.generalMessageArea.style.display = 'none'; }
        function displayFieldError(fieldId, messageKey, replacements = {}) { /* ... (Keep) ... */
             const errorElId = errorFieldMapDisplay[fieldId]; if (errorElId) { const errorEl = document.getElementById(errorElId); if (errorEl) errorEl.textContent = getMessageDisplay(messageKey, replacements); }
        }
        function clearAllFieldErrors() { /* ... (Keep) ... */
             for (const fieldId in errorFieldMapDisplay) { const errorEl = document.getElementById(errorFieldMapDisplay[fieldId]); if (errorEl) errorEl.textContent = ''; }
        }

        function formatDate(dateStr, lang, options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' }) { /* ... (Keep) ... */
            if (!dateStr) return ''; return new Date(dateStr + 'T00:00:00').toLocaleDateString(lang === 'fr' ? 'fr-FR' : 'en-US', options); // Ensure date is parsed as local
        }
        function formatDateTime(dateStr, timeStr, lang) { /* ... (Keep, ensure timeStr is handled if null/empty) ... */
            if (!dateStr) return '';
            const dateTimeString = dateStr + (timeStr ? `T${timeStr}` : 'T00:00:00'); // Default to midnight if no time
            return new Date(dateTimeString).toLocaleString(lang === 'fr' ? 'fr-FR' : 'en-US', { dateStyle: 'full', timeStyle: timeStr ? 'short' : undefined });
        }

        function updateMetaTags(data) { /* ... (Keep existing, ensure ui.meta... are correct) ... */
            const pageUrl = window.location.href; const title = `${data.eventName} - MonRdvFacile`;
            const description = (data.eventDescription || '').substring(0, 155);
            document.title = title;
            if(ui.metaDescriptionTag) ui.metaDescriptionTag.content = description; if(ui.canonicalLinkTag) ui.canonicalLinkTag.href = pageUrl;
            if(ui.ogTitleTag) ui.ogTitleTag.content = title; if(ui.ogDescriptionTag) ui.ogDescriptionTag.content = description;
            if(ui.ogUrlTag) ui.ogUrlTag.content = pageUrl; if(ui.twitterTitleTag) ui.twitterTitleTag.content = title;
            if(ui.twitterDescriptionTag) ui.twitterDescriptionTag.content = description; if(ui.twitterUrlTag) ui.twitterUrlTag.content = pageUrl;
        }

        function renderVisualTableLayout(numTables, chairsPerTable) { /* ... (Keep existing) ... */
            ui.tablesDisplayContainerEl.innerHTML = '';
            if (numTables > 0 && chairsPerTable > 0) {
                ui.eventTableLayout.style.display = 'block';
                for (let i = 0; i < numTables; i++) {
                    const tableBox = document.createElement('div'); tableBox.className = 'display-table-box';
                    tableBox.innerHTML = `<strong>${getMessageDisplay('tableLabel')} ${i + 1}</strong><br><span class="display-table-chairs">${chairsPerTable} ${getMessageDisplay('chairsLabel')}</span>`;
                    ui.tablesDisplayContainerEl.appendChild(tableBox);
                }
                ui.totalCapacityInfoEl.textContent = getMessageDisplay('totalCapacityText', { capacity: numTables * chairsPerTable, tables: numTables, chairs: chairsPerTable });
            } else {
                ui.eventTableLayout.style.display = 'none';
            }
        }

        function renderDetailedMenu(menuStructure) {
            ui.detailedMenuContainer.innerHTML = '';
            if (menuStructure && Array.isArray(menuStructure) && menuStructure.length > 0) {
                ui.detailedMenuDisplaySection.style.display = 'block';
                menuStructure.forEach(section => {
                    const sectionDiv = document.createElement('div');
                    sectionDiv.className = 'menu-display-section';
                    const sectionTitle = document.createElement('h5');
                    sectionTitle.textContent = section.title;
                    sectionDiv.appendChild(sectionTitle);

                    if (section.items && section.items.length > 0) {
                        const ul = document.createElement('ul');
                        section.items.forEach(item => {
                            const li = document.createElement('li');
                            const itemNameSpan = document.createElement('span');
                            itemNameSpan.className = 'menu-item-name';
                            itemNameSpan.textContent = item.name;
                            li.appendChild(itemNameSpan);

                            if (item.price !== null && item.price !== undefined) {
                                const itemPriceSpan = document.createElement('span');
                                itemPriceSpan.className = 'menu-item-price';
                                itemPriceSpan.textContent = `${parseFloat(item.price).toFixed(2)} €`;
                                li.appendChild(itemPriceSpan);
                            }
                            ul.appendChild(li);
                        });
                        sectionDiv.appendChild(ul);
                    }
                    ui.detailedMenuContainer.appendChild(sectionDiv);
                });
            } else {
                ui.detailedMenuDisplaySection.style.display = 'none';
            }
        }

        function populateEventDetails(data) {
            currentEventData = data;
            updateMetaTags(data);

            ui.eventTitleEl.textContent = data.eventName;
            
            // Badge Display Logic
            ui.eventBadgeDisplayWrapper.innerHTML = ''; // Clear previous badges
            let hasBadge = false;
            if (data.eventBadge && data.eventBadge !== 'none') {
                const mainBadge = document.createElement('span');
                mainBadge.className = `badge-display badge-${data.eventBadge}`;
                mainBadge.textContent = getMessageDisplay(data.eventBadge) || data.eventBadge.charAt(0).toUpperCase() + data.eventBadge.slice(1);
                ui.eventBadgeDisplayWrapper.appendChild(mainBadge);
                hasBadge = true;
            }
            if (data.locationType === 'online') {
                const onlineBadge = document.createElement('span');
                onlineBadge.className = 'badge-display badge-online';
                onlineBadge.textContent = getMessageDisplay('onlineBadgeText') || (currentLangDisplay === 'fr' ? 'En Ligne' : 'Online'); // Add onlineBadgeText to messages
                ui.eventBadgeDisplayWrapper.appendChild(onlineBadge);
                hasBadge = true;
            }
            if (data.isPaidEvent) {
                const paidBadge = document.createElement('span');
                paidBadge.className = 'badge-display badge-paid';
                paidBadge.textContent = getMessageDisplay('paidBadgeText') || (currentLangDisplay === 'fr' ? 'Payant' : 'Paid'); // Add paidBadgeText to messages
                ui.eventBadgeDisplayWrapper.appendChild(paidBadge);
                hasBadge = true;
            }
            ui.eventBadgeDisplayWrapper.style.display = hasBadge ? 'flex' : 'none';


            if(data.organizerName) {
                ui.eventOrganizerName.textContent = data.organizerName;
                ui.organizerDisplay.style.display = 'block';
            } else {
                ui.organizerDisplay.style.display = 'none';
            }

            ui.eventStartDateEl.textContent = formatDate(data.eventStartDate, currentLangDisplay);
            ui.eventEndDateEl.textContent = formatDate(data.eventEndDate, currentLangDisplay);
            
            ui.eventStartTimeEl.textContent = data.eventStartTime || "";
            ui.eventEndTimeEl.textContent = data.eventEndTime || "";
            ui.eventStartTimeDisplayRow.style.display = data.eventStartTime ? 'flex' : 'none';
            ui.eventEndTimeDisplayRow.style.display = data.eventEndTime ? 'flex' : 'none';

            ui.eventDeadlineEl.textContent = formatDateTime(data.registrationDeadlineDate, data.registrationDeadlineTime, currentLangDisplay);
            ui.eventDescriptionEl.textContent = data.eventDescription;

            // Location Details
            ui.locationInfoSection.innerHTML = `<h4 data-fr="Lieu de l'Événement" data-en="Event Location">${getMessageDisplay('locationHeading') || 'Lieu'}</h4>`; // Add locationHeading to messages
            if (data.locationType === 'online') {
                const onlineP = document.createElement('p');
                onlineP.className = 'location-detail';
                onlineP.innerHTML = `<i class="fas fa-video"></i> <strong>${getMessageDisplay('onlineEventLabel')}</strong> <a href="${data.onlineMeetingLink}" target="_blank" rel="noopener noreferrer">${getMessageDisplay('joinMeetingText')}</a>`;
                ui.locationInfoSection.appendChild(onlineP);
            } else { // Offline
                if (data.venueName) {
                    const venueP = document.createElement('p');
                    venueP.className = 'location-detail';
                    venueP.innerHTML = `<i class="fas fa-map-marker-alt"></i> <strong>${getMessageDisplay('venueNameLabel')}</strong> ${data.venueName}`;
                    ui.locationInfoSection.appendChild(venueP);
                }
                if (data.eventLocationAddress) {
                    const addressP = document.createElement('p');
                    addressP.className = 'location-detail';
                    addressP.innerHTML = `<i class="fas fa-home"></i> <strong>${getMessageDisplay('addressLabel')}</strong> ${data.eventLocationAddress.replace(/\n/g, '<br>')}`;
                    ui.locationInfoSection.appendChild(addressP);
                }
                if (data.eventLocationGMapLink) {
                    const mapLinkP = document.createElement('p');
                    mapLinkP.className = 'location-detail';
                    mapLinkP.innerHTML = `<a href="${data.eventLocationGMapLink}" class="gmap-link" target="_blank" rel="noopener noreferrer"><i class="fas fa-map-marked-alt"></i> ${getMessageDisplay('gmapLinkText')}</a>`;
                    ui.locationInfoSection.appendChild(mapLinkP);
                } else if (data.eventLocationAddress) { // Try to generate a link
                    const generatedMapLink = `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(data.eventLocationAddress)}`;
                    const mapLinkP = document.createElement('p');
                    mapLinkP.className = 'location-detail';
                    mapLinkP.innerHTML = `<a href="${generatedMapLink}" class="gmap-link" target="_blank" rel="noopener noreferrer"><i class="fas fa-map-marked-alt"></i> ${getMessageDisplay('gmapLinkText')} (via adresse)</a>`;
                    ui.locationInfoSection.appendChild(mapLinkP);
                }
            }


            if (data.isPaidEvent) {
                ui.eventPriceEl.textContent = `${parseFloat(data.eventPrice).toFixed(2)} €`;
                ui.eventPriceDisplayEl.style.display = 'block';
                ui.paymentOptionsGroup.style.display = 'block';
                ui.paymentInstructionsEl.textContent = getMessageDisplay('paymentInstructionText', {price: `${parseFloat(data.eventPrice).toFixed(2)} €`});
                document.querySelectorAll('input[name="paidStatus"]').forEach(rb => rb.required = true);
            } else { /* ... hide ... */ }

            // Handle menu display
            if (data.menuStructure && data.menuStructure.length > 0) {
                renderDetailedMenu(data.menuStructure);
                ui.menuSelectionGroup.style.display = 'none'; // Hide old simple menu form
                ui.menuChoiceSelect.required = false;
            } else if (data.numMenus > 0 && data.menuNames && data.menuNames.length > 0) { // Fallback to old menu system
                ui.detailedMenuDisplaySection.style.display = 'none';
                ui.menuSelectionGroup.style.display = 'block';
                ui.menuChoiceSelect.required = true;
                ui.menuChoiceSelect.innerHTML = ''; // Clear
                const defaultOption = document.createElement('option'); /* ... add default ... */
                defaultOption.value = ""; defaultOption.textContent = getMessageDisplay('selectMenuDefault');
                defaultOption.disabled = true; defaultOption.selected = true;
                ui.menuChoiceSelect.appendChild(defaultOption);
                data.menuNames.forEach(menuName => { /* ... populate ... */
                    const option = document.createElement('option'); option.value = menuName; option.textContent = menuName;
                    ui.menuChoiceSelect.appendChild(option);
                });
            } else { // No menu
                ui.detailedMenuDisplaySection.style.display = 'none';
                ui.menuSelectionGroup.style.display = 'none';
                ui.menuChoiceSelect.required = false;
            }
            
            renderVisualTableLayout(data.numTables, data.chairsPerTable);
            
            if (data.allowSeatSelection) {
                ui.seatSelectionStatus.textContent = getMessageDisplay('seatSelectionAllowed');
                ui.seatSelectionInfo.style.display = 'block';
                // Future: Add seat selection UI trigger here
            } else {
                ui.seatSelectionStatus.textContent = getMessageDisplay('seatSelectionNotAllowed');
                ui.seatSelectionInfo.style.display = 'block'; // Still show the status
            }


            const pageUrl = window.location.href;
            ui.copyLinkButton.onclick = () => { /* ... copy logic ... */ };
            ui.whatsappShareLink.href = `whatsapp://send?text=${encodeURIComponent(data.eventName + " - " + getMessageDisplay('joinMeAt') + pageUrl)}`;

            ui.eventContentDiv.style.display = 'block';
            hideGeneralMessage();
        }
        
        async function fetchEventDetails(eventId) { /* ... (Keep existing, ensure it calls the updated populateEventDetails) ... */
            showGeneralMessage('loading', 'loading');
            try {
                const response = await fetch(`${WORKER_EVENT_URL}/${eventId}`);
                if (!response.ok) { throw new Error(`HTTP ${response.status}: ${response.statusText}`); }
                const data = await response.json();
                if (data && data.success && data.event) { populateEventDetails(data.event); }
                else { showGeneralMessage('eventNotFound', 'error'); ui.eventContentDiv.style.display = 'none'; }
            } catch (error) { console.error("Fetch error:", error); showGeneralMessage('apiError', 'error'); ui.eventContentDiv.style.display = 'none'; }
        }

        function validateRegistrationForm(showGeneralMsg = true) { /* ... (Keep existing, ensure menuChoice validation adapts) ... */
            let isValid = true; clearAllFieldErrors();
            const userName = document.getElementById('userName').value.trim();
            const userEmail = document.getElementById('userEmail').value.trim();
            const userPhone = document.getElementById('userPhone').value.trim();
            if (!userName) { displayFieldError('userName', 'required'); isValid = false; }
            if (!userEmail) { displayFieldError('userEmail', 'required'); isValid = false; }
            else if (!/^\S+@\S+\.\S+$/.test(userEmail)) { displayFieldError('userEmail', 'emailInvalid'); isValid = false; }
            if (!userPhone) { displayFieldError('userPhone', 'required'); isValid = false; }
            
            // Only validate simple menu if it's visible and required
            if (ui.menuSelectionGroup.style.display !== 'none' && ui.menuChoiceSelect.required) {
                if (!ui.menuChoiceSelect.value) { displayFieldError('menuChoice', 'required'); isValid = false; }
            }
            // Future: Add validation for detailed menu selection here if implemented in form

            if (currentEventData.isPaidEvent) {
                const paidStatusSelected = document.querySelector('input[name="paidStatus"]:checked');
                if (!paidStatusSelected) { displayFieldError('paidStatus', 'paymentOptionRequired'); isValid = false; }
            }
            if(!isValid && showGeneralMsg) showGeneralMessage('formErrors', 'error');
            return isValid;
        }

        ui.registrationForm.addEventListener('submit', async function(event) { /* ... (Keep existing, ensure it sends correct menu data if detailed menu selection is added later) ... */
            event.preventDefault(); hideGeneralMessage();
            if (!currentEventData || !validateRegistrationForm()) return;
            const formData = new FormData(this);
            const registrationData = { eventId: currentEventData.id, eventName: currentEventData.eventName };
            formData.forEach((value, key) => { registrationData[key] = value; });
            // If detailed menu selection is implemented, collect its data here
            // For now, it relies on the simple 'menuChoice' from the form if that field is active.

            const submitButton = document.getElementById('submitRegistrationBtn');
            const originalButtonHTML = submitButton.innerHTML;
            submitButton.disabled = true; submitButton.innerHTML = `<i class="fas fa-spinner fa-spin"></i> ${(currentLangDisplay === 'fr' ? 'Envoi...' : 'Submitting...')}`;
            try {
                const response = await fetch(WORKER_REGISTER_URL, {
                    method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(registrationData)
                });
                const result = await response.json();
                if (response.ok && result.success) {
                    let successMessageKey = 'registrationSuccess';
                    if (result.message && result.message.toLowerCase().includes("waitlist")) {
                        successMessageKey = 'addedToWaitlist';
                    }
                    showGeneralMessage(successMessageKey, 'success', {message: result.message});
                    ui.registrationForm.style.display = 'none';
                    ui.confirmationDetailsEl.innerHTML = `
                        <p><strong>${getMessageDisplay('confirmName')}</strong> ${registrationData.userName}</p>
                        <p><strong>${getMessageDisplay('confirmEmail')}</strong> ${registrationData.userEmail}</p>
                        <p><strong>${getMessageDisplay('confirmPhone')}</strong> ${registrationData.userPhone}</p>
                        ${(currentEventData.numMenus > 0 && registrationData.menuChoice) ? `<p><strong>${getMessageDisplay('confirmMenu')}</strong> ${registrationData.menuChoice}</p>` : ''}
                        ${currentEventData.isPaidEvent ? `<p><strong>${getMessageDisplay('confirmPaidStatus')}</strong> ${registrationData.paidStatus === 'yes' ? getMessageDisplay('paidStatusYes') : getMessageDisplay('paidStatusNo')}</p>` : ''}
                        ${result.message && result.message.toLowerCase().includes("waitlist") ? `<p style="font-weight:bold;">${result.message}</p>`: ''}
                    `;
                    ui.registrationConfirmationMessageEl.style.display = 'block';
                } else { showGeneralMessage('registrationError', 'error', { error: result.error || result.message || 'Unknown error' }); }
            } catch (error) { console.error("Submit error:", error); showGeneralMessage('apiError', 'error');
            } finally { submitButton.disabled = false; submitButton.innerHTML = originalButtonHTML; }
        });

        function initializePage() {
            queryTranslatableItemsDisplay();
            const preferredLang = detectLanguagePreferenceDisplay();
            updateUIDisplayLanguage(preferredLang);
            const urlParams = new URLSearchParams(window.location.search);
            const eventId = urlParams.get('id');
            if (eventId) { fetchEventDetails(eventId); }
            else { showGeneralMessage('eventNotFound', 'error'); ui.eventContentDiv.style.display = 'none'; }
            window.triggerPageLanguageUpdate = function(langFromHf) {
                if (langFromHf !== currentLangDisplay) { queryTranslatableItemsDisplay(); updateUIDisplayLanguage(langFromHf); }
                else { queryTranslatableItemsDisplay(); updateUIDisplayLanguage(currentLangDisplay); }
            };
        }
        initializePage();
        setTimeout(() => { if (!window.hfHasTriggeredLanguageUpdate) { console.log("Fallback: Re-querying language for hf.js."); queryTranslatableItemsDisplay(); updateUIDisplayLanguage(currentLangDisplay);}}, 300);
        console.log("event-display.html (v2 - Enhanced Features) JS loaded.");
    });
    </script>
</body>
</html>
